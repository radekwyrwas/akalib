<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-15">
<title>BondOAS Library Documentation</title>
<style type='text/css'>
body {
    padding: 1em;
}

div.code {
    white-space: pre;
    font-family: courier;
    font-size: 110%;
}

div.blockcomment {
    border: thin solid;
    padding: 1em 2em;
}

i.comment {
    font-family: times;
/*
    font-size: 90%;
    color: red;
*/
}

a {
    text-decoration: none;
}

a:visited {
    color: blue;
}

a:hover {
    text-decoration: underline;
}

div#contents {
    position: fixed;
    top: 10px;
    right: 10px;
    border: thin solid;
    background: lightpink;
    padding: .25em;
    /* for IE */
    filter:alpha(opacity=85);
    /* CSS3 standard */
    opacity: 0.85;
    -moz-opacity: 0.85 
}

div#contents ul {
    padding-left: 1.5em;
}

div#contents span {
    text-align: center;
    text-decoration: underline;
    display: block;
    font-weight: bold;
    cursor: pointer;
}


</style>
<script type='text/javascript'>
function toggle_contents() {
    var div = document.getElementById('inner_contents');
    div.style.display = (div.style.display == 'none') ? '' : 'none';
}
</script>
</head>
<body>
<a name='contents0'></a><h1>BondOAS Library Description</h1>
<p>BondOAS&reg; is a rigorously developed, thoroughly tested valuation engine for the universe of fixed coupon bonds. These can be step-up coupon, callable, putable, amortizing, and pre-refunded securities. Option types covered include American, Bermudan, European, and Canary (like Bermudan but can stop being callable before maturity). The structures can be sinking fund bonds with acceleration options (double-up, etc.) and delivery options (the ability of the issuer to buy below par and deliver in lieu of sinking at par).</p>

<p>The library contains a suite of internally consistent analytical routines, the primary ones being arbitrage-free valuation, conventional price/yield calculations, and scenario analysis. Its speed and accuracy makes it ideal for interactive applications or high volume processing.</p>

<p>BondOAS&reg; is widely used in trading, risk management, and pricing systems (including intra-day pricing of bond ETFs). Clients include major investment banks, rating agencies, pricing services, risk management vendors, and global financial information services.</p>

<p>BondOAS&reg; runs on Windows, Solaris, and Linux platforms. Java wrappers are available for each of these platforms.</p>

<a name='contents1'></a><h2>Lattice calibration</h2>

<p>BondOAS&reg; uses a proprietary tetranomial lattice model employing the Black-Karasinski interest rate process. The user can specify either a) the volatility of the short-term rate and a mean reversion factor (which together determine the long-rate volatility) or b) the volatilities of the short and long rates (which together determine the mean reversion factor).</p>

<a name='contents2'></a><h2>Valuation</h2>

<p>Bonds and embedded options are valued recursively on the calibrated interest rate lattice. Given an option-adjusted spread (OAS), BondOAS will shift the discount rate at each node on the lattice accordingly, apply it to the cash flow, check for option exercise if relevant, and report a price. Option values are extracted by taking the difference between the value of the underlying bullet bond and the value of the bond with embedded option(s).</p>

<p>Given a price, BondOAS uses an iterative process to calculate the OAS. A trial OAS is added to the discount rate at every node on the lattice. If the resulting price using recursive valuation on the lattice is too low, the next try is a lower OAS; if the resulting price is too high, a higher OAS is attempted. The process is highly optimized for rapid convergence.</p>

<a name='contents3'></a><h2>Coverage</h2>
<ul>
<li>Fixed coupon, including step-coupon</li>
<li>US agency bonds</li>
<li>US corporate bonds</li>
<li>US municipal bonds</li>
<li>US Treasury notes and bonds</li>
<li>Foreign sovereigns</li>
<li>Foreign corporates</li>
</ul>

<a name='contents4'></a><h2>Lattice-based Calculations</h2>
<ul>
<li>Option Adjusted Spread (OAS) given price</li>
<li>Fair value given OAS</li>
<li>I-spread, G-spread and Z-spread</li>
<li>Effective duration convexity, DV01</li>
<li>Key-rate durations</li>
</ul>

<a name='contents5'></a><h2>Conventional Bond Calculations</h2>
<ul>
<li>Price/yield conversions for the standard daycounts (Yields: YTM, YTC, YTP, YTW, CFY)</li>
<li>After-tax yields for tax-exempt bonds incorporating OID and market discount de minimis rules</li>
<li>Accrued interest for the standard daycounts</li>
<li>Modified duration, convexity, DV01</li>
<li>Modified duration and convexity to worst</li>
<li>Cashflows</li>
</ul>

<a name='contents6'></a><h2>Scenario Analysis and Stress Testing</h2>
<ul>
<li>Total return given holding period and interest rate scenario</li>
<li>Scenario-dependent calls and puts exercised optimally during the holding period (not available from other vendors)</li>
<li>Yield Curve Analysis</li>
<li>Volatility term structure (implied by short rate volatility and mean reversion, or short rate volatility and long rate volatility)</li>
<li>Discount factors, zero coupon rates and forward rates corresponding to a par yield curve</li>
</ul>

<a name='contents7'></a><h2>Applications</h2>
<ul>
<li>Real-time pricing</li>
<li>End-of-day-marking to market</li>
<li>Risk management</li>
<li>Index calculation</li>
<li>Trading</li>
<li>Client reporting</li>
<li>Back office post-trade processing</li>
<li>Model validation</li>
</ul>

<a name='contents8'></a><h2>Performance</h2>
<ul>
<li>OAS-to-price: 2.3 million bullets, 0.3 million callables per minute</li>
<li>Price-to-OAS: approximately 3 times slower</li>
<li>Lattice calibrations: 3,000 per minute</li>
<li>Results on Intel 3.07Ghz</li>
</ul>
<a name='contents9'></a><h1>BondOAS Library API &mdash; akaapi.h</h1>
<div>
</div>
<div class='blockcomment'>
<p>* Copyright (c) 1995-2011, Andrew Kalotay Associates.  All rights reserved. *
</p>
</div>
<div class='code'>



</div>
<div class='blockcomment'>
<a name='contents10'></a><h2>Overview</h2>
<p>This file contains the function prototypes, structure definitions,
and constants needed for invoking BondOAS(tm).  This file also
serves as documentation for the API.  It is arranged in the
following sections:
</p>
<ol>
<li>General Notes</li>
<li>Initialization and Shutdown</li>
<li>Tree Creation</li>
<li>Valuation</li>
<li>Miscellaneous Functions</li>
<li>Error Handling</li>
<li>Memory Allocation and Free</li>
<li>Data Structures and Constants</li>
<li>Deprecated Functions</li>
</ol>
</div>
<div class='code'>


</div>
<div class='blockcomment'>
<a name='contents11'></a><h2>Section 1. General Notes</h2>
<p>BondOAS(tm) is a multi-thread safe C library.  Library interface
calls take objects in the form of C structures.  These structures
are described below.  All structures are documented.
</p>
<p>All dates are expressed as 8-digit longs in the form yyyymmdd.
Percentages are expressed as x 100.  I.e., 10% is 10 rather than 0.10.
</p>
<p>Most AKA structures have memory allocation and free routines.  All
AKA structures which have allocators (e.g., Bond structures) must
be allocated using the library provided allocation functions only.
Using stack local variables or directly allocating the structures
via malloc will cause unexpected results and memory errors.
</p>
</div>
<div class='code'>


</div>
<div class='blockcomment'>
<a name='contents12'></a><h2>Section 2. Initialization and Shutdown</h2>
<p>One of the initialization functions must be called before the library
may be used.
</p>
<p>The library requires a valid user name and key to run.  These must be
provided to the initialization routines.  The user name and key are
authorization keys provided to authorized users by AKA.
</p>
<p>The initialization routines return one of the AKAINIT_ERR_ values
defined below.  The return code must be checked; continuing to call
BondOAS routines after init fails will cause the library to exit.
</p>
<p>One of the shutdown functions should be called after the library use
is finished.  Memory will be lost if this is not done.
</p>
<p>The initialization function should not be called more than once.  It
is valid to call the initialization function again if the shutdown
function has been called.  This is not recommended as initialization
and shutdown functions require cycles.
</p>
<p>MULTI-THREAD note: only one thread may call the initialization
function.  The initialization function creates BondOAS mutex.
Calling the shutdown function while other threads are still running
BondOAS routines is not safe.  The configuration settings used in
the init function are inherited by each thread.  The duration global
settings can be reset on a per thread basis, see AKA_set_duration_shift().
</p>
</div>
<div class='code'>


typedef struct <a href="#struct AKAInitData">AKAInitData</a> <a name=AKAINITDATA></a><b>AKAINITDATA</b>;

#define AKAINIT_ERR_NONE 0      <i class='comment'>/* no error */</i>
#define AKAINIT_ERR_AUTHORIZE 1 <i class='comment'>/* user is not authorized to run library */</i>
#define AKAINIT_ERR_ALLOC 2     <i class='comment'>/* memory allocation error */</i>

<i class='comment'>/* The initialization routines return one of AKAINIT_ERR_ defined above.
   AKA_initialize() uses default configuration values; see AKAINITDATA
   below. */</i>
long <a name="AKA_initialize"></a><b>AKA_initialize</b>(long key, const char *uname);
long <a name="AKA_initialize_configure"></a><b>AKA_initialize_configure</b>(long key, const char *uname,
			      <a href="#AKAINITDATA">AKAINITDATA</a> *config);

<i class='comment'>/* Gets the default initialization configuration values and assigns
   them to the passed in configuration structure. */</i>
void <a name="AKA_initialize_get_defaults"></a><b>AKA_initialize_get_defaults</b>(<a href="#AKAINITDATA">AKAINITDATA</a> *config);

<i class='comment'>/* Returns expiration of key; only valid after call to init, */</i>
void <a name="AKA_authorize_expiration_date"></a><b>AKA_authorize_expiration_date</b>(int *year, int *month, int *day);

<i class='comment'>/* Shutdown the library, free internal memory */</i>
void <a name="AKA_shutdown"></a><b>AKA_shutdown</b>();

<i class='comment'>/* Shutdown the library */</i>
void <a name="AKA_shutdown_configure"></a><b>AKA_shutdown_configure</b>(int unused);

<i class='comment'>/* The variable, AKA_memory_diagnostics_enabled, controls whether all
   memory allocations in library routines are wrapped in a memory
   diagnostics counter.  Enabling memory diagnostics allows the user
   track library memory usage.  The variable must be set to one prior
   to library initialization in order for memory diaganostics to be
   enabled.  Enabling memory diagnostics will impact performance of
   multi-threaded invocations of the bondoas library. */</i>
extern int AKA_memory_diagnostics_enabled;

<i class='comment'>/* Provides diagnostics information on library memory usage.
   Allocations, total_memory, and trees are a snapshot of usage when
   the function is called.  The numbers are for unfreed allocations and
   unreleased trees.  After shutdown, all the numbers should be zero.
   This routine is multi-thread safe.  Note, allocations and total_memory
   will always be zero unless AKA_memory_diagnostics_enabled is set. */</i>
void <a name="AKA_memory_diagnostics"></a><b>AKA_memory_diagnostics</b>(unsigned long *allocations, size_t *total_memory,
			    unsigned long *trees);



</div>
<div class='blockcomment'>
<a name='contents13'></a><h2>Section 3. Tree Creation</h2>
<p>Trees are interest rate lattices used to value instruments.  The
first step in any valuation is to create a tree using one of the
tree fit routines below.
</p>
<p>These return an AKAHTREE which is a library internal reference.  The
user is given the handle to pass to other routines. This is not a
pointer.  The AKATreeRelease() routine frees internal library
memory.  After AKATreeRelease(), the handle is no longer valid.
Un-released trees will cause memory leaks.
An AKAHTREE of zero indicates failure and is not a valid tree.
</p>
<p>MULTI-THREAD note: the tree handle may be shared across threads.
Freeing the handle via AKATreeRelease() more than once is not safe.
Freeing the handle while it is in use by multiple threads is not safe.
</p>
<p>Performance Note: When AKABondVal() and AKABondVal2() is used to
compute par duration, the library will internally attempt to fit
trees.  The handles to these trees are not exposed to the caller.
They will be cached internally with the tree structure.
</p>
</div>
<div class='code'>

typedef unsigned long <a name=AKAHTREE></a><b>AKAHTREE</b>;   <i class='comment'>/* Returned from tree fit routines */</i>

<i class='comment'>/* forward declarations -- definitions in structures section below */</i>
typedef struct <a href="#struct AKACurve">AKACurve</a> <a name=AKACURVE></a><b>AKACURVE</b>;
typedef struct <a href="#struct AKASpreads">AKASpreads</a> <a name=AKASPREAD></a><b>AKASPREAD</b>;

<i class='comment'>/* Fit trees from yield curves; spread curves are optional, pass as NULL */</i>
<a href="#AKAHTREE">AKAHTREE</a> <a name="AKATreeFit"></a><b>AKATreeFit</b>(const <a href="#AKACURVE">AKACURVE</a> *crv, const <a href="#AKASPREAD">AKASPREAD</a> *spr);

<i class='comment'>/* Fit a tree from another tree and a spread curve */</i>
<a href="#AKAHTREE">AKAHTREE</a> <a name="AKATreeFitSpreads"></a><b>AKATreeFitSpreads</b>(<a href="#AKAHTREE">AKAHTREE</a> tree, const <a href="#AKASPREAD">AKASPREAD</a> *spr);

<i class='comment'>/* Fit a tree from another tree and a shift of the zero or par curve.
   bpShift of 20 means 20 basis points.  Select mode from <a href="#enum_AKAShiftMode">AKAShiftMode</a>
   defined below. Using SHIFT_NONE here is an error. */</i>
<a href="#AKAHTREE">AKAHTREE</a> <a name="AKATreeFitShift"></a><b>AKATreeFitShift</b>(<a href="#AKAHTREE">AKAHTREE</a> tree, double bpShift, long mode);

<i class='comment'>/* Fit a tree from a yield curve using zero volatility.  For computing
   Z-Spread.  Z-Spread is the zero-volatility OAS of a bond given its
   price. */</i>
<a href="#AKAHTREE">AKAHTREE</a> <a name="AKATreeFitZero"></a><b>AKATreeFitZero</b>(const <a href="#AKACURVE">AKACURVE</a> *crv);

<i class='comment'>/* Return the minimum rate on a tree (.10 is 10%) -1 is error */</i>
double <a name="AKATreeMinRate"></a><b>AKATreeMinRate</b>(<a href="#AKAHTREE">AKAHTREE</a> hTree);

<i class='comment'>/* Release a tree handle returned by one of the tree fit routines */</i>
void <a name="AKATreeRelease"></a><b>AKATreeRelease</b>(<a href="#AKAHTREE">AKAHTREE</a> tree);


</div>
<div class='blockcomment'>
<a name='contents14'></a><h2>Section 4. Valuation</h2>
<p>These routines value bonds.
</p>
<p>There are two types of valuation routines.
</p>
<ol>
<li>Simple Valuation -- return a single value through the function return</li>
<li>Report Based -- return multiple values via a report structure</li>
</ol>
<p>Simple Valuation routines return their answer as the function
return value.  Error return values are as described below.  These
routines also set the error handling flags like the Report Based
routines.
</p>
<p>Report Based routines require a report structure to be passed in.  All 
report structures except AKABONDREPORT must be created with the 
appropriate allocation function and must be freed with the corresponding 
free function.  The return code for report based functions is not used.
See the error handling section below for checking errors.
</p>
<p>MULTI-THREAD note: AKAHTREE may be shared across threads.  Pointers
to AKABOND and AKASCEN are to const objects in these functions and
therefore may be shared across threads.  However, changing the values
of an AKABOND or AKASCEN while it is in use by another thread
violates the const requirement and is not thread safe.
</p>
</div>
<div class='code'>
<i class='comment'>/* forward declarations -- definitions below */</i>
typedef struct <a href="#struct AKABond">AKABond</a> <a name=AKABOND></a><b>AKABOND</b>;
typedef struct <a href="#struct AKAScen">AKAScen</a> <a name=AKASCEN></a><b>AKASCEN</b>;
typedef struct <a href="#struct AKABondReport">AKABondReport</a> <a name=AKABONDREPORT></a><b>AKABONDREPORT</b>;
typedef struct <a href="#struct AKABondYieldReport">AKABondYieldReport</a> <a name=AKABONDYIELDREPORT></a><b>AKABONDYIELDREPORT</b>;
typedef struct <a href="#struct AKAFlowReport">AKAFlowReport</a> <a name=AKAFLOWREPORT></a><b>AKAFLOWREPORT</b>;
typedef struct <a href="#struct AKAFwdReport">AKAFwdReport</a> <a name=AKAFWDREPORT></a><b>AKAFWDREPORT</b>;
typedef struct <a href="#struct AKAKRDurReport">AKAKRDurReport</a> <a name=AKAKRDURREPORT></a><b>AKAKRDURREPORT</b>;
typedef struct <a href="#struct AKAkrdursetup">AKAkrdursetup</a> <a name=AKAKRDURSETUP></a><b>AKAKRDURSETUP</b>;
typedef struct <a href="#struct AKAScenReport">AKAScenReport</a> <a name=AKASCENREPORT></a><b>AKASCENREPORT</b>;
typedef struct <a href="#struct AKAVolReport">AKAVolReport</a> <a name=AKAVOLREPORT></a><b>AKAVOLREPORT</b>;
typedef struct <a href="#struct AKAYldWorst">AKAYldWorst</a> <a name=AKAYLDWORST></a><b>AKAYLDWORST</b>;
typedef struct <a href="#struct AKAPrcWorst">AKAPrcWorst</a> <a name=AKAPRCWORST></a><b>AKAPRCWORST</b>;
typedef struct <a href="#struct AKAAtaxYld">AKAAtaxYld</a> <a name=AKAATAXYLD></a><b>AKAATAXYLD</b>;
typedef struct <a href="#struct AKAAtaxBasis">AKAAtaxBasis</a> <a name=AKAATAXBASIS></a><b>AKAATAXBASIS</b>;

<i class='comment'>/* ********************************************
   SIMPLE VALUATION routines
   ******************************************** */</i>
<i class='comment'>/* Price a bond; returns price; -1 indicates an error */</i>
double <a name="AKABondPrice"></a><b>AKABondPrice</b>(long pvdate, <a href="#AKAHTREE">AKAHTREE</a> hTree, const <a href="#AKABOND">AKABOND</a> *bond,
		    double oas);

<i class='comment'>/* Compute the OAS for a bond; returns OAS; -99999 indicates an error */</i>
double <a name="AKABondOAS"></a><b>AKABondOAS</b>(long pvdate, <a href="#AKAHTREE">AKAHTREE</a> hTree, const <a href="#AKABOND">AKABOND</a> *bond,
		  double price);

<i class='comment'>/* Determine accrued for a bond - returns accrued; -1 indicates an error */</i>
double <a name="AKABondAccrued"></a><b>AKABondAccrued</b>(long pvdate, const <a href="#AKABOND">AKABOND</a> *bond);

<i class='comment'>/* Determine accrued and accrued days for a bond.
   Returns 1 on success, 0 on an error */</i>
double <a name="AKABondAccrued2"></a><b>AKABondAccrued2</b>(long pvdate, const <a href="#AKABOND">AKABOND</a> *bond,
		       double *accrued, int *accrued_days);

<i class='comment'>/* Spot shift (see AKAShiftMode, below) a tree &lt;treeshift&gt; basis points
   then value a bond; returns price; -1 indicates an error */</i>
double <a name="AKABondPriceShifted"></a><b>AKABondPriceShifted</b>(long pvdate, <a href="#AKAHTREE">AKAHTREE</a> hTree, const <a href="#AKABOND">AKABOND</a> *bond,
			   double oas, double treeshift);

<i class='comment'>/* convert between price and yield.  Select cnvfrom/cnvto from <a href="#enum_AKAQuoteType">AKAQuoteType</a>
   defined below.  AKAQuoteType OAS is not supported for price conversion.
   To convert from OAS use AKABondVal().
   Returns:   value in cnvto units; -99999 indicates an error. */</i>
double <a name="AKABondPriceCnv"></a><b>AKABondPriceCnv</b>(long pvdate, long cnvfrom, long cnvto, double quote,
		       const <a href="#AKABOND">AKABOND</a> *bond);

<i class='comment'>/* Solve for a single fixed spread such that if the same spread is
   added to each coupon in the coupon schedule of the bond, then the
   clean price of the bond, computed using the tree with zero OAS, is
   equal to clean_price provided as input.
   Returns: this spread, in basis points, with sign reversed
   -99999 indicates an error. */</i>
double <a name="AKAAssetSwapSpread"></a><b>AKAAssetSwapSpread</b>(double clean_price, 
                          long pvdate, 
                          <a href="#AKAHTREE">AKAHTREE</a> hTree, 
                          const <a href="#AKABOND">AKABOND</a> *bond);


<i class='comment'>/* Compute the price of a bond at zero oas when the input asset_swap_spread is
   applied.
   Returns: the clean price
   -99999 indicates an error */</i>
double <a name="AKAConvertAssetSwapSpread"></a><b>AKAConvertAssetSwapSpread</b>(double asset_swap_spread,
                                 long pvdate, 
                                 <a href="#AKAHTREE">AKAHTREE</a> hTree, 
                                 const <a href="#AKABOND">AKABOND</a> *bond);

<i class='comment'>/* Compute the I-Spread.  This is the difference between the YTM of a
   bond at the provided price, and the yield on the
   weighted-average-maturity-matched point on the provided yield
   curve. The yield will be straight-line interpolated between points
   on the provided curve. Industry refers to this spread as I-Spread
   if swap curve provided and G-Spread if government curve
   (treasuries) provided.
   Returns: this spread, in basis points, -99999 indicates an error. */</i>
double <a name="AKAISpread"></a><b>AKAISpread</b>(const <a href="#AKABOND">AKABOND</a> *bond, long pvdate, double price,
		  const <a href="#AKACURVE">AKACURVE</a> *crv);


<i class='comment'>/* ********************************************
   REPORT STRUCTURE BASED VALUATION routines
   ******************************************** */</i>

<i class='comment'>/* Value a bond and fill out all fields in the bond report (see
   bond report definition below).  Select quoteType from <a href="#enum_AKAQuoteType">AKAQuoteType</a> */</i>
long <a name="AKABondVal"></a><b>AKABondVal</b>(long pvDate, long quoteType, double quote,
		<a href="#AKAHTREE">AKAHTREE</a> hTree, const <a href="#AKABOND">AKABOND</a> *bond,
		<a href="#AKABONDREPORT">AKABONDREPORT</a> *rpt);

<i class='comment'>/* Like AKABondVal() but allows configuration of which bond report
   values to calculate.  See the definition of the bond report below
   to understand which values are calculated. Set value_x to 1 to
   value, zero to not value. */</i>
long <a name="AKABondVal2"></a><b>AKABondVal2</b>(long pvDate, long quoteType, double quote,
		 <a href="#AKAHTREE">AKAHTREE</a> hTree, const <a href="#AKABOND">AKABOND</a> *bond,
		 <a href="#AKABONDREPORT">AKABONDREPORT</a> *rpt,
		 int value_option, int value_duration, int value_yield);

<i class='comment'>/* Perform scenario analysis on a bond, uses efficiency set in init().
   Special Note: Scenario analysis is based on input yield curves and
   the OAS implied by the initial price.  In situations where the user
   inputs a price that implies an unreasonable OAS, the scenario-based
   option exercise and cashflow reinvestment calculations may be
   distorted.  Assuming the input initial yield curve is appropriate
   for the issuer of the security, the user can suppress the use of
   implied OAS for purposes of option exercise and reinvestment by
   entering the initial price as a negative price, i.e., 99.375 is
   entered as -99.375.  In this case only the horizon price will be
   calculated using the implied OAS.  All option exercise decisions
   and reinvestment calculations will be made with an OAS of 0
   relative to the entered curves.

   AKAScenFree() does not release the trees.  The trees in the AKASCEN
   structure must be created and released by the caller.  Using
   AKA_SCEN_GRADUAL is slow.  Using AKA_SCEN_GRADUAL with factor curve
   based trees is particularly slow. */</i>

long <a name="AKABondScen"></a><b>AKABondScen</b>(long quoteType, double quote,
		 const <a href="#AKASCEN">AKASCEN</a> *scen, const <a href="#AKABOND">AKABOND</a> *bond,
		 <a href="#AKASCENREPORT">AKASCENREPORT</a> *rpt);

<i class='comment'>/* Like AKABondScen() but allows setting of efficiency threshold and returns
   the observed efficiency */</i>
long <a name="AKABondScen2"></a><b>AKABondScen2</b>(long quoteType, double quote,
		  const <a href="#AKASCEN">AKASCEN</a> *akascen, const <a href="#AKABOND">AKABOND</a> *bond,
		  <a href="#AKASCENREPORT">AKASCENREPORT</a> *rpt,
		  double eff_threshold, double *efficiency);

<i class='comment'>/* Like AKABondScen2() but if reinvest is greater than zero, use the
   supplied reinvestment rate rather than the scenario indicated forward
   rate plus the instrument OAS.  Rate is as percent, i.e., for 10% use
   10. Rate is BEY, 30/360 semi-annual */</i>
long <a name="AKABondScen3"></a><b>AKABondScen3</b>(long quoteType, double quote,
		  const <a href="#AKASCEN">AKASCEN</a> *akascen, const <a href="#AKABOND">AKABOND</a> *bond,
		  <a href="#AKASCENREPORT">AKASCENREPORT</a> *rpt,
		  double eff_threshold, double *efficiency, double reinvest);

<i class='comment'>/* Like AKABondScen3() but if ataxinfo is non-null does an after tax
   total return analysis.  The AKAATAXYLD input fields must be filled out
   if ataxinfo is non-null.  The AKAATAXYLD report output fields are not
   computed -- the report is only used in this routine to supply input data.
   To compute aftertax yields see AKAAtaxYield() below. */</i>
long <a name="AKABondScen4"></a><b>AKABondScen4</b>(long quoteType, double quote,
		  const <a href="#AKASCEN">AKASCEN</a> *akascen, const <a href="#AKABOND">AKABOND</a> *bond,
		  <a href="#AKASCENREPORT">AKASCENREPORT</a> *rpt,
		  double eff_threshold, double *efficiency, double reinvest,
		  <a href="#AKAATAXYLD">AKAATAXYLD</a> *ataxinfo);

<i class='comment'>/* Compute the key rate durations for a bond and return the results
   in an allocated report.  The returned report must be freed by the
   caller using AKAKRDurReportFree().  On failure, it returns NULL.
   This routine uses shifts of the par curve at each maturity to do
   duration.  These are created by calling AKAKeyDurSetup(); */</i>
<a href="#AKAKRDURREPORT">AKAKRDURREPORT</a> *<a name="AKABondKeyDur3"></a><b>AKABondKeyDur3</b>(long pvdate, const <a href="#AKABOND">AKABOND</a> *bond,
			       long quoteType, double quote,
			       <a href="#AKAKRDURSETUP">AKAKRDURSETUP</a> *setup);

<i class='comment'>/* Construct a structure for computing the key rate durations of a
   bond using the specified duration shift (durbp), at specific
   maturities.  This structure is used in AKABondKeyDur3().  The array
   maturities contains the specific key rates for which to calculate
   duration.  If it is NULL (or maturities_count is zero) all the
   maturities in the curve are used.  maturities_count must be the
   number of elements in the maturities_array.  This structure must
   be freed by the caller using AKAKeyDurSetupFree(). */</i>
<a href="#AKAKRDURSETUP">AKAKRDURSETUP</a> *<a name="AKAKeyDurSetup"></a><b>AKAKeyDurSetup</b>(const <a href="#AKACURVE">AKACURVE</a> *curve, const <a href="#AKASPREAD">AKASPREAD</a> *spread,
			      double durbp,
			      double *maturities, int maturities_count);

<i class='comment'>/* Frees the structure created in AKAKeyDurSetup().  Always returns NULL. */</i>
<a href="#AKAKRDURSETUP">AKAKRDURSETUP</a> *<a name="AKAKeyDurSetupFree"></a><b>AKAKeyDurSetupFree</b>(<a href="#AKAKRDURSETUP">AKAKRDURSETUP</a> *setup);


<i class='comment'>/* AKABondKeyDur2() is the same as invoking, AKAKeyDurSetup(), then
   AKABondKeyDur3(), and finally AKAKeyDurSetupFree().  Because
   creating the par shifted trees for each maturity is relatively
   expensive, calling this routine repeatedly with the same
   curve/spread is inefficient.  Use AKABondKeyDur3(), instead. */</i>
<a href="#AKAKRDURREPORT">AKAKRDURREPORT</a> *<a name="AKABondKeyDur2"></a><b>AKABondKeyDur2</b>(long pvdate, const <a href="#AKABOND">AKABOND</a> *bond,
			       long quoteType, double quote,
			       const <a href="#AKACURVE">AKACURVE</a> *curve, const <a href="#AKASPREAD">AKASPREAD</a> *spread,
			       int durbp,
			       <a href="#AKAKRDURREPORT">AKAKRDURREPORT</a> *rpt);


<i class='comment'>/* AKABondKeyDur() is exactly the same as calling AKABondKeyDur2()
   with the rpt structure being NULL. */</i>
<a href="#AKAKRDURREPORT">AKAKRDURREPORT</a> *<a name="AKABondKeyDur"></a><b>AKABondKeyDur</b>(long pvdate, const <a href="#AKABOND">AKABOND</a> *bond,
			      long quoteType, double quote,
			      const <a href="#AKACURVE">AKACURVE</a> *curve, const <a href="#AKASPREAD">AKASPREAD</a> *spread,
			      int durbp);



<i class='comment'>/* Compute key-rate durations using SPOT shift.  It must be passed
   an allocated AKAKRDURREPORT with the maturities of the desired key
   rates for dutations, already filled out.  Because it does spot
   shifts of the tree, we recommend using AKABondKeyDur3(), instead. */</i>
long <a name="AKABondKRDur"></a><b>AKABondKRDur</b>(long pvDate, long quoteType, double quote,
		  <a href="#AKAHTREE">AKAHTREE</a> hTree, const <a href="#AKABOND">AKABOND</a> *bond,
		  <a href="#AKAKRDURREPORT">AKAKRDURREPORT</a> *rpt);


<i class='comment'>/* Both the following cash flow reports use the same structure.  The
   first simply reports the cash flows from the instrument.  The
   second discounts the flows and calculates bond value
   fundamentals. */</i>

<i class='comment'>/* report cashflows -- leaves much of the report structure blank */</i>
long <a name="AKABondFlowOnly"></a><b>AKABondFlowOnly</b>(long pvDate, const <a href="#AKABOND">AKABOND</a> *bond, <a href="#AKAFLOWREPORT">AKAFLOWREPORT</a> *rpt);


<i class='comment'>/* Compute and discount cashflows */</i>
long <a name="AKABondFlow"></a><b>AKABondFlow</b>(long pvDate, long quoteType, double quote,
		 <a href="#AKAHTREE">AKAHTREE</a> hTree, const <a href="#AKABOND">AKABOND</a> *bond,
		 <a href="#AKAFLOWREPORT">AKAFLOWREPORT</a> *rpt);

<i class='comment'>/* Compute yield for each option exercise date in option schedules and to
   maturity.  If both a call and a put are in effect, both are reported.
   The function also returns the lowest of all these yields.  */</i>
long <a name="AKAYieldToWorst"></a><b>AKAYieldToWorst</b>(long pvDate, long quoteType, double quote,
		     const <a href="#AKABOND">AKABOND</a> *bond, <a href="#AKAYLDWORST">AKAYLDWORST</a> *rpt);

<i class='comment'>/* Same as AKAYieldToWorst except that yields are computed to each sink
   date. */</i>
long <a name="AKALowestYieldToSink"></a><b>AKALowestYieldToSink</b>(long pvDate, long quoteType, double quote,
			   const <a href="#AKABOND">AKABOND</a> *bond, <a href="#AKAYLDWORST">AKAYLDWORST</a> *rpt);

<i class='comment'>/* Compute yields for each option or flow date of a bond.  The price
   of the bond must be supplied.  The two control flags ascfy and
   tosink extend the behavior.  If tosink is 1 the worst yields are
   for yields to sink dates.  If ascfy is 1 the ytc, ytp, and worst
   yields are on a cash flow basis.  The two flags can be combined.
   If both ascfy is 0 and tosink is 0, the behavior is the same as
   AKABondValueYields().  */</i>
long <a name="AKAYieldToWorstEx"></a><b>AKAYieldToWorstEx</b>(long pvDate, long quoteType, double quote,
		       const <a href="#AKABOND">AKABOND</a> *bond, int tosink, int ascfy,
		       <a href="#AKAYLDWORST">AKAYLDWORST</a> *rpt);

<i class='comment'>/* Compute price for each option exercise date in option schedules and to
   maturity.  If both a call and a put are in effect, both are reported.
   The function also returns the lowest of all these prices.
   The bond ytm is used as the yield at each date when computing the price.
   If the provided quoteType is not AKA_QUOTE_YTM, the ytm will be calculated
   based on the provided quote. */</i>
long <a name="AKAPriceToWorst"></a><b>AKAPriceToWorst</b>(long pvDate, long quoteType, double quote,
		     const <a href="#AKABOND">AKABOND</a> *bond, <a href="#AKAPRCWORST">AKAPRCWORST</a> *rpt);

<i class='comment'>/* Fill out aftertax yield report -- input fields in report structure
   must be filled out prior to invocation.  Pvdate is purchase date,
   and quote is purchase price. quoteType cannot be OAS. */</i>
long <a name="AKAAtaxYield"></a><b>AKAAtaxYield</b>(long pvDate, long quoteType, double quote,
		  const <a href="#AKABOND">AKABOND</a> *bond, <a href="#AKAATAXYLD">AKAATAXYLD</a> *rpt);

<i class='comment'>/* Fill out aftertax basis report -- input fields in report structure
   must be filled out prior to invocation.  Pvdate is sale date, and
   quote is sale price. quoteType cannot be OAS. */</i>
long <a name="AKAAtaxBasis"></a><b>AKAAtaxBasis</b>(long pvDate, long quoteType, double quote,
		  const <a href="#AKABOND">AKABOND</a> *akabond, <a href="#AKAATAXBASIS">AKAATAXBASIS</a> *rpt);

<i class='comment'>/* Compute yields and modified durations for a bond.  The price of
   the bond must be supplied. */</i>
long <a name="AKABondValueYields"></a><b>AKABondValueYields</b>(long pvdate, double price, const <a href="#AKABOND">AKABOND</a> *bond,
			<a href="#AKABONDYIELDREPORT">AKABONDYIELDREPORT</a> *rpt);

<i class='comment'>/* Compute yields and modified durations for a bond.  The price of the
   bond must be supplied.  The two control flags ascfy and tosink
   extend the behavior.  If tosink is 1 the worst yields are for
   yields to sink dates.  If ascfy is 1 the ytc, ytp and worst yields
   are on a cash flow basis.  The two flags can be combined.  If both
   ascfy and tosink are 0, the behavior is the same as
   AKABondValueYields().  */</i>
long <a name="AKABondValueYieldsEx"></a><b>AKABondValueYieldsEx</b>(long pvdate, double price, const <a href="#AKABOND">AKABOND</a> *bond,
			  int tosink, int ascfy, <a href="#AKABONDYIELDREPORT">AKABONDYIELDREPORT</a> *rpt);


<i class='comment'>/* ********************************************
   AFTER-TAX VALUATION
   ******************************************** */</i>

<i class='comment'>/* Enable/Disable all price and OAS calculations performed on this
   bond to be done on an after-tax basis.  This will alter the output
   of most valuation routines except pure yield calculations.  A
   non-zero value to on_off enables, a zero value disables. */</i>
void <a name="AKAAfterTax"></a><b>AKAAfterTax</b>(<a href="#AKABOND">AKABOND</a> *bond, int on_off);

<i class='comment'>/* Set the default tax rate used for after-tax valuation of bonds.  Tax-rates
   are as percents, i.e., 15 is 15%.
   If this function is not called the defaults are: 35%, 35%, 15%, 15% */</i>
void <a name="AKADefaultTaxRate"></a><b>AKADefaultTaxRate</b>(double income, double capgain_short, double capgain_long,
		       double capgain_superlong);

<i class='comment'>/* Set the after-tax rate of a specific bond -- will use defaults otherwise */</i>
void <a name="AKABondTaxRate"></a><b>AKABondTaxRate</b>(<a href="#AKABOND">AKABOND</a> *bond,
		    double income, double capgain_short, double capgain_long,
		    double capgain_superlong);

</div>
<div class='blockcomment'>
<a name='contents15'></a><h2>Section 5. Miscellaneous Functions</h2>
</div>
<div class='code'>

<i class='comment'>/* Version information as floating point number in the format v.rr
   where
   v = major version number
   rr = minor release number
   e.g., 1.10 */</i>
double <a name="AKA_version"></a><b>AKA_version</b>();

<i class='comment'>/* Version information as a string: AKA BondOAS Library version v.rr */</i>
<a href="#const char">const char</a> *<a name="AKA_version_string"></a><b>AKA_version_string</b>();

<i class='comment'>/* Compute par curves at forward times based on rates
   of input tree or curve.  See definition of AKAFWDRATE report below */</i>
long <a name="AKAFwdRates"></a><b>AKAFwdRates</b>(<a href="#AKAHTREE">AKAHTREE</a> hTree, <a href="#AKAFWDREPORT">AKAFWDREPORT</a> *report);
long <a name="AKAFwdRatesFromCurve"></a><b>AKAFwdRatesFromCurve</b>(<a href="#AKACURVE">AKACURVE</a> *curve, <a href="#AKAFWDREPORT">AKAFWDREPORT</a> *report);

<i class='comment'>/* Probe the term structure of volatility */</i>
long <a name="AKAYieldVol"></a><b>AKAYieldVol</b>(<a href="#AKAHTREE">AKAHTREE</a> hTree, <a href="#AKAVOLREPORT">AKAVOLREPORT</a> *report);

struct <a name="struct TREESAMPLE"></a><b>TREESAMPLE</b>;
<i class='comment'>/* Provide random walks through the expected interest rates in order
   to do sampling valuation analysis. */</i>
int <a name="AKA_treesample"></a><b>AKA_treesample</b>(<a href="#AKACURVE">AKACURVE</a> *curve, <a href="#struct TREESAMPLE">struct TREESAMPLE</a> *sample);

<i class='comment'>/* Set the duration shift method and basis points - like in AKAINITDATA.
   Permits the user to reset the duration shift paremeters during
   a run of the library.
   MUTLI-THREAD note: this routine is multi-thread safe.
   It will change these settings for the thread only. */</i>
void <a name="AKA_set_duration_shift"></a><b>AKA_set_duration_shift</b>(long smode, double bp_no_options,
			    double bp_with_options);



</div>
<div class='blockcomment'>
<a name='contents16'></a><h2>Section 6. Error Handling</h2>
<p>Errors during calls to BondOAS routines are pushed on an error stack.
After the call, the stack can be checked by popping msgs using
AKA_msg_pop().
</p>
<p>Messages are NOT cleared between calls. The user must clear the stack
by popping messages or by using AKAFatalReset() which clears everything.
</p>
<p>After a fatal error, results of valuation routines are not defined.
</p>
<p>MUTLI-THREAD note: each thread has its own error message stack.  All
error handling routines are per thread.  Errors for one thread are
not visible to any other thread.
</p>
</div>
<div class='code'>

typedef enum {			<i class='comment'>/* Error Message type enumerations. */</i>
    AKA_MSG_NONE = 0,
    AKA_MSG_INFORMATION = 1,
    AKA_MSG_WARNING = 2,
    AKA_MSG_FATAL = 3
} AKA_MSGTYPE;

#define AKA_MSG_MAXLEN 300	<i class='comment'>/* max length of an error message string */</i>

<i class='comment'>/* Pop the messages off the message stack - returns AKA_MSG_NONE when empty
   text must be at least char[AKA_MSG_MAXLEN].
   The order messages are popped is determined by the AKAInitData configuration
   setting, msg_pop_order. */</i>
<a href="#AKA_MSGTYPE">AKA_MSGTYPE</a> <a name="AKA_msg_pop"></a><b>AKA_msg_pop</b>(char *text);

<i class='comment'>/* Returns TRUE if there is a fatal error on the message stack */</i>
int <a name="AKAFatalStatus"></a><b>AKAFatalStatus</b>();

<i class='comment'>/* Clears the message stack */</i>
void <a name="AKAFatalReset"></a><b>AKAFatalReset</b>();

<i class='comment'>/* Push a message onto the error message stack */</i>
void <a name="AKA_msg_push"></a><b>AKA_msg_push</b>(char *text, <a href="#AKA_MSGTYPE">AKA_MSGTYPE</a> mtype);

<i class='comment'>/* Suppress all messages at or below mtype level.  Returns suppression
   level prior to new setting.  AKA_msg_suppress(AKA_MSG_FATAL) suppresses
   all message.  AKA_msg_suppress(AKA_MSG_NONE) enables all messages. */</i>
<a href="#AKA_MSGTYPE">AKA_MSGTYPE</a> <a name="AKA_msg_suppress"></a><b>AKA_msg_suppress</b>(<a href="#AKA_MSGTYPE">AKA_MSGTYPE</a> mtype);

<i class='comment'>/* Returns the highest error level of message on the msg queue. */</i>
<a href="#AKA_MSGTYPE">AKA_MSGTYPE</a> <a name="AKA_msg_status"></a><b>AKA_msg_status</b>();

</div>
<div class='blockcomment'>
<a name='contents17'></a><h2>Section 7. Memory Allocation and Free</h2>
<p>These routines must be used to allocate and free BondOAS structures.
</p>
<p>All AKA structures which have allocators (e.g., Bond structures)
must be allocated using the library provided allocation functions,
only.  Using stack local variables or directly allocating the
structures via malloc will cause unexpected results and memory
errors.
</p>
</div>
<div class='code'>

<i class='comment'>/* forward declarations -- definitions below */</i>
typedef struct <a href="#struct AKASecurity">AKASecurity</a> <a name=AKASECURITY></a><b>AKASECURITY</b>;
typedef struct <a href="#struct AKACoupon">AKACoupon</a> <a name=AKACOUPON></a><b>AKACOUPON</b>;
typedef struct <a href="#struct AKAOption">AKAOption</a> <a name=AKAOPTION></a><b>AKAOPTION</b>;
typedef struct <a href="#struct AKASink">AKASink</a> <a name=AKASINK></a><b>AKASINK</b>;

AKACURVE * AKACurveAlloc(long n);
AKACURVE * AKACurveFree(AKACURVE *curve);

AKASPREAD * AKASpreadAlloc(long n);
AKASPREAD * AKASpreadFree(AKASPREAD *spr);

AKABOND * AKABondAlloc(long nCpns, long nCalls, long nPuts, long nSinks);
AKABOND * AKABondFree(AKABOND *bond);

AKASECURITY * AKASecurityAlloc();
AKASECURITY * AKASecurityFree(AKASECURITY *sec);

AKACOUPON * AKACouponAlloc(long n);
AKACOUPON * AKACouponFree(AKACOUPON *cpn);

AKAOPTION * AKAOptionAlloc(long n);
AKAOPTION * AKAOptionFree(AKAOPTION *opt);

AKASINK * AKASinkAlloc(long n);
AKASINK * AKASinkFree(AKASINK *opt);

AKASCEN * AKAScenAlloc(long n);
AKASCEN * AKAScenFree(AKASCEN *scen);

AKAFLOWREPORT * AKAFlowReportAlloc();
AKAFLOWREPORT * AKAFlowReportSubAlloc(AKAFLOWREPORT *rpt, int nFlows);
AKAFLOWREPORT * AKAFlowReportFree(AKAFLOWREPORT *rpt);

AKAKRDURREPORT * AKAKRDurReportAlloc(long n);
AKAKRDURREPORT * AKAKRDurReportFree(AKAKRDURREPORT *rpt);

AKAFWDREPORT * AKAFwdReportAlloc(long nTimes, long nMats);
AKAFWDREPORT * AKAFwdReportFree(AKAFWDREPORT *rpt);

AKAVOLREPORT * AKAVolReportAlloc(long n);
AKAVOLREPORT * AKAVolReportFree(AKAVOLREPORT *rpt);

AKAYLDWORST * AKAYldWorstReportAlloc();
AKAYLDWORST * AKAYldWorstReportFree(AKAYLDWORST *rpt);

AKAPRCWORST * AKAPrcWorstReportAlloc();
AKAPRCWORST * AKAPrcWorstReportFree(AKAPRCWORST *rpt);

<a href="#struct TREESAMPLE">struct TREESAMPLE</a> *<a name="AKA_treesample_alloc"></a><b>AKA_treesample_alloc</b>(int nmats, int npaths, int ntimes);
void <a name="AKA_treesample_free"></a><b>AKA_treesample_free</b>(<a href="#struct TREESAMPLE">struct TREESAMPLE</a> *sample);


</div>
<div class='blockcomment'>
<a name='contents18'></a><h2>Section 8. Data Structures and Constants</h2>
<p>It is important to read the notes in Section 7., above, about using
AKA allocation functions.
</p>
</div>
<div class='code'>

<i class='comment'>/* MULTI-THREAD note: all initialization settings are global and are across
   all threads. */</i>

<i class='comment'>/* ********************************************
   INITIALIZATION structure with global configuration settings
   ******************************************** */</i>
struct <a name="struct AKAInitData"></a><b>AKAInitData</b>
{
	<i class='comment'>/* the following three settings are deprecated and ignored */</i>
    char   treePath[512];
    long   maxTrees;
    long   maxTreesPurge;

    long   msg_pop_order;	<i class='comment'>/* 0 - last on first off (compatibility default)
				   1 - first on first off (recommended) */</i>
    long   enable_tls;		<i class='comment'>/* controls use of thread local storage
				   -1 -- do not use tls
				    0  -- use default setting for architecture
				    1 -- enable tls
				   The default settings are:
				   linux/linux64 : tls enabled
				   win32/64 lib_md : tls enabled
				   win32/64 lib_mt, dll : tls disabled
				   solaris : ignored, cannot be enabled */</i>

    long   treeCacheSize;	<i class='comment'>/* deprecated and ignored */</i>

    long   _reserved3;		<i class='comment'>/* reserved for future use */</i>

	<i class='comment'>/* duration calculation settings */</i>
    long   durationShift;    <i class='comment'>/* Select from <a href="#enum_AKAShiftMode">AKAShiftMode</a>:
				default: AKA_SHIFT_PAR */</i>
    double durBPNoOpts;      <i class='comment'>/* Duration shift when no options present
				default: 10.0 */</i>
    double durBPOpts;        <i class='comment'>/* Duration shift when options present
				default: 40.0 */</i>

	<i class='comment'>/* scenario analysis settings for old style scenario analysis calls */</i>
    double efficiency;       <i class='comment'>/* Efficiency of option exercise
				default: 100.0 */</i>
};


<i class='comment'>/* ********************************************
   RATE TERM structure
   ******************************************** */</i>
struct <a name="struct AKACurve"></a><b>AKACurve</b>	      <i class='comment'>/* Curve specified at a list of maturities in years */</i>
{
    long    mode;     <i class='comment'>/* Volatilty type.  Select from <a href="#enum_AKAVolatilityMode">AKAVolatilityMode</a>: */</i>
                      <i class='comment'>/* AKA_VOLMODE_MEANREV:  Supply mean reversion,
			 compute lvol */</i>
                      <i class='comment'>/* AKA_VOLMODE_LONGVOL:  Supply lvol,
			 compute mean reversion */</i>

    double  vol;      <i class='comment'>/* Short-rate volatility, 18% represented as 18.0 */</i>
    double  lvol;     <i class='comment'>/* 30-year rate volatility, 12% represented as 12.0 */</i>
    double  alpha;    <i class='comment'>/* Mean reversion speed, 2% represented as 2.0 */</i>


    long    type;     <i class='comment'>/* Select from <a href="#enum_AKACurveType">AKACurveType</a> */</i>

    long    reseverd; <i class='comment'>/* reserved for future use */</i>

    long    n;        <i class='comment'>/* Number of entries */</i>

    double *time;     <i class='comment'>/* Years in appropriate daycount convention */</i>
    double *yield;    <i class='comment'>/* Rates:  7% as 7.0;  Discount factors:  0.9 as 0.9 */</i>
};


<i class='comment'>/* ********************************************
   ISSUER SPREAD structure
   ******************************************** */</i>
struct <a name="struct AKASpreads"></a><b>AKASpreads</b>    <i class='comment'>/* BEY corporate bond spreads */</i>
{
    long    n;       <i class='comment'>/* Number of points */</i>
    double *time;    <i class='comment'>/* Time in 30/360 years */</i>
    double *spread;  <i class='comment'>/* Spread in BEY bp; 25 bp represented as 25.0 */</i>
};


<i class='comment'>/* ********************************************
   BOND structure, and supporting sub-structures

   It is important to read the notes in Section 7., above, about using
   AKA allocation functions.
   ******************************************** */</i>
struct <a name="struct AKABond"></a><b>AKABond</b>
{
    AKASECURITY *sec;

    AKACOUPON   *cpn;   <i class='comment'>/* Set to NULL for fixed-coupon bond */</i>

    AKAOPTION   *call;  <i class='comment'>/* Issuer's option */</i>
    AKAOPTION   *put;   <i class='comment'>/* Holder's option */</i>

    AKASINK     *sink;  <i class='comment'>/* Sinking fund options */</i>
};


struct <a name="struct AKASecurity"></a><b>AKASecurity</b>
{
    char    name[80];     <i class='comment'>/* Optional identifier */</i>

    long    idate;        <i class='comment'>/* Issue date (yyyymmdd) (optional; defaults
			   * to ddate) */</i>
    long    ddate;        <i class='comment'>/* Dated date (yyyymmdd) */</i>
    long    fcdate;       <i class='comment'>/* First coupon date (optional; defaults to
			     the first flow date after the idate,
			     determined by the frequency, counting
			     back from the lcdate) */</i>
    long    lcdate;       <i class='comment'>/* Last regular coupon date (optional;
			   * defaults to maturity) */</i>
    long    mdate;        <i class='comment'>/* Maturity date */</i>
	<i class='comment'>/* NOTE:
	   To specify an interest at maturity bond, set the fcdate to
	   the mdate and either leave the lcdate unspecified (zero) or
	   set it to the mdate as well.
	*/</i>
    long    daycount;     <i class='comment'>/* Select from <a href="#enum_AKADaycount">AKADaycount</a> */</i>
    long    frequency;    <i class='comment'>/* Select from <a href="#enum_AKAFrequency">AKAFrequency</a> */</i>
    long    ex_cpn_days;  <i class='comment'>/* Number of days bond trades ex-coupon
			   * (optional; defaults to zero)*/</i>
    long    payday;       <i class='comment'>/* The day of the month on which the coupon
			     is paid.  Optional; defaults to day of
			     the month of the lcdate.  It should be
			     set when the payday is at the end of the
			     month.  For example, if a bond matures on
			     6/30, does it pay interest on 12/30 or
			     12/31?  Set payday to 31 to obtain the
			     latter behavior.  Warning: Setting payday
			     to 30 or 31 for bonds that do not mature
			     on those days will shift the cash flows
			     to those days.  Set to -1 to have library
			     use the last day of the month for the
			     payday only if the maturity date is on
			     the last day of the month, i.e., use
			     payday of 31st if appropriate. */</i>

    double  redemption_value;  <i class='comment'>/* Usually 100, sometimes not at par.
                                  Useful for valuing pre-refunded bonds that
                                  are defeased to the first call date and the
				  call is at a premium. */</i>

    double  coupon;       <i class='comment'>/* Fixed coupon, ignored for step-ups */</i>

    long    yld_method;	  <i class='comment'>/* Select from <a href="#enum_AKA_YIELD_METHOD">AKA_YIELD_METHOD</a> */</i>

    double  issue_price;    <i class='comment'>/* defaults to par, only used in after-tax
			       valuation */</i>
    void *taxinfo;   <i class='comment'>/* configuration data for AKAAfterTax, do
			not assign or access directly */</i>
};


struct <a name="struct AKACoupon"></a><b>AKACoupon</b>  <i class='comment'>/* Used for step-up coupons */</i>
{
    long    n;        <i class='comment'>/* Number of coupon/date pairs */</i>
    long    type;     <i class='comment'>/* Select from <a href="#enum_AKAPeriodType">AKAPeriodType</a> */</i>
    long   *date;     <i class='comment'>/* Coupon period boundary dates (see type) */</i>
    double *cpn;      <i class='comment'>/* Coupons, 7.0% represented as 7.0 */</i>
};


struct <a name="struct AKAOption"></a><b>AKAOption</b>  <i class='comment'>/* Used for call and put options */</i>
{
    long    n;        <i class='comment'>/* Number of strike dates (0 =&gt; No option) */</i>
    long    type;     <i class='comment'>/* Select from <a href="#enum_AKAOptionType">AKAOptionType</a> */</i>
    long    delay;    <i class='comment'>/* Number of days notice required */</i>
    long   *date;     <i class='comment'>/* Strike dates */</i>
    double *px;       <i class='comment'>/* Strike prices */</i>
};


struct <a name="struct AKASink"></a><b>AKASink</b>  <i class='comment'>/* Sinking fund option */</i>
{
    long    n;             <i class='comment'>/* Number of sink dates (0 =&gt; No sinking fund) */</i>
    long    delivery;      <i class='comment'>/* Issuer's option to buy bonds in open market */</i>
                           <i class='comment'>/* and deliver to trustee to meet SF requirement */</i>
                           <i class='comment'>/* 1 if present, 0 otherwise */</i>
    long    allocation;    <i class='comment'>/* Select from <a href="#enum_AKAAllocation">AKAAllocation</a> */</i>
    double  face;          <i class='comment'>/* Original face in dollars */</i>
    double  outstanding;   <i class='comment'>/* Current amount outstanding in dollars */</i>
    double  acceleration;  <i class='comment'>/* 100 for a double-up, 200 for triple-up, etc. */</i>
    double  accumulation;  <i class='comment'>/* Face amount in dollars held by accumulators */</i>
    long   *date;          <i class='comment'>/* Sink dates */</i>
    double *amt;           <i class='comment'>/* Sink amounts in dollars */</i>
    double *px;            <i class='comment'>/* Sink prices (usually 100) */</i>
};


<i class='comment'>/* ********************************************
   SCENARIO valuation structure
   ******************************************** */</i>
struct <a name="struct AKAScen"></a><b>AKAScen</b>  <i class='comment'>/* Simple interest rate scenario */</i>
{
    long      type;   <i class='comment'>/* Select from <a href="#enum_AKAScenType">AKAScenType</a> */</i>
    long      n;      <i class='comment'>/* Number of points (n &gt;= 2) */</i>
    long     *dates;  <i class='comment'>/* Vector of dates (yyyymmdd) */</i>
    AKAHTREE *trees;  <i class='comment'>/* Vectors of prevailing trees */</i>
};


<i class='comment'>/* ********************************************
   REPORT BASED VALUATION routines structures
   ******************************************** */</i>
struct <a name="struct AKABondReport"></a><b>AKABondReport</b>
{
	<i class='comment'>/* price is always calculated (or supplied) */</i>
    double  price;     <i class='comment'>/* Dollar price as a percentage of par */</i>
	<i class='comment'>/* accrued is always calculated */</i>
    double  accrued;   <i class='comment'>/* Accrued as a percentage of par */</i>
	<i class='comment'>/* option value is calculated if value options is set */</i>
    double  optval;    <i class='comment'>/* Option value as a percentage of par */</i>
	<i class='comment'>/* oas is always calculated (or supplied) */</i>
    double  oas;       <i class='comment'>/* Option-adjusted spread, 25 bp = 25.0 */</i>

	<i class='comment'>/* duration values are calculated if value duration is set */</i>
    double  effDur;    <i class='comment'>/* Option adjusted duration in years */</i>
    double  effCon;    <i class='comment'>/* (vup - 2*v + vdn)/(v*(dr)^2) */</i>
    double  effDV01;   <i class='comment'>/* (price + accrued)*effDur/100.0 */</i>

	<i class='comment'>/* yields are calculated if value yields is set */</i>
    double  ytm;       <i class='comment'>/* Yield to maturity, 7% = 7.0; ignores amortization */</i>
    double  ytc;       <i class='comment'>/* Yield to next call */</i>
    double  ytp;       <i class='comment'>/* Yield to next put */</i>
    double  cfy;       <i class='comment'>/* Cashflow yield; includes amoritzation */</i>
    double  wam;       <i class='comment'>/* Weighted average maturity in years */</i>

	<i class='comment'>/* modified duration values are calculated if value yields is set */</i>
    double  modDur;    <i class='comment'>/* Modified duration in years */</i>
    double  modCon;    <i class='comment'>/* Modified convexity, same units as effCon */</i>
    double  modDV01;   <i class='comment'>/* (price + accrued)*modDur/100.0 */</i>
};


struct <a name="struct AKABondYieldReport"></a><b>AKABondYieldReport</b>
{
    double  ytm;       <i class='comment'>/* Yield to maturity, 7% = 7.0 */</i>
    double  ytc;       <i class='comment'>/* Yield to call */</i>
    double  ytp;       <i class='comment'>/* Yield to put */</i>
    double  cfy;       <i class='comment'>/* Cashflow yield */</i>
    double  wam;       <i class='comment'>/* Weighted average maturity in years */</i>

    double  modDur;    <i class='comment'>/* Modified duration in years */</i>
    double  modCon;    <i class='comment'>/* Modified convexity, same units as effCon */</i>
    double  modDV01;   <i class='comment'>/* (price + accrued)*modDur/100.0 */</i>
    double  modDurCall; <i class='comment'>/* Modified duration to call */</i>

	<i class='comment'>/* to worst values */</i>
    long worstdate;		<i class='comment'>/* date of worst option exercise */</i>
    double ytw;			<i class='comment'>/* yield to worst */</i>
    double modDurWorst;		<i class='comment'>/* modified duration to worst */</i>
    double modConWorst;		<i class='comment'>/* modified convexity to worst */</i>
};

struct <a name="struct AKAFlowReport"></a><b>AKAFlowReport</b>
{
    long    nFlows;    <i class='comment'>/* Number of cashflows remaining */</i>

	<i class='comment'>/* These bond fundamental values are not calculated
	   by the flow only cash flow function */</i>
    double  oas;       <i class='comment'>/* Option-adjusted spread */</i>
    double  value;     <i class='comment'>/* Fair value */</i>
    double  accrued;   <i class='comment'>/* Accrued interest */</i>
    double  optval;    <i class='comment'>/* Value of embedded options */</i>
    double  npv;       <i class='comment'>/* Net present value of scheduled flows */</i>

	<i class='comment'>/* The remaining elements are arrays of nFlows doubles. */</i>
	<i class='comment'>/* The following are returned by each cash flow function. */</i>
    long   *date;      <i class='comment'>/* Cashflow dates (yyyymmdd) */</i>

    double *iflow;     <i class='comment'>/* Interest flows */</i>
    double *pflow;     <i class='comment'>/* Principal flows */</i>
    double *tflow;     <i class='comment'>/* Total cashflow */</i>

	<i class='comment'>/* These discounted cash flow calculations are not calculated
	   by the flow only cash flow function */</i>
    double *zero;      <i class='comment'>/* Zero-coupon rate */</i>
    double *factor;    <i class='comment'>/* Discount factor */</i>
    double *pv;        <i class='comment'>/* Present values of individual flows */</i>
};


struct <a name="struct AKAFwdReport"></a><b>AKAFwdReport</b>
{
	<i class='comment'>/* INPUTS */</i>
    long    nMats;      <i class='comment'>/* Number of maturities in computed yield curves */</i>
    long    nTimes;     <i class='comment'>/* Number of forward times at which to solve */</i>
    double  *mats;      <i class='comment'>/* Maturities for which to solve (e.g., 1yr, 5yr) */</i>
    double  *times;     <i class='comment'>/* Times at which to solve (e.g., 6mo, 1yr ...)*/</i>
	<i class='comment'>/* OUTPUT */</i>
    double **fwds;      <i class='comment'>/* nTimes par curves, each with nMats maturities,
			   i.e., fwds[iTime][iMat] */</i>
};


struct <a name="struct AKAKRDurReport"></a><b>AKAKRDurReport</b>
{
    long    n;         <i class='comment'>/* Number of maturities supplied (input/output) */</i>
    double  oas;       <i class='comment'>/* Option-adjusted spread */</i>
    double  value;     <i class='comment'>/* Fair value */</i>
    double  accrued;   <i class='comment'>/* Accrued interest */</i>
    double  npv;       <i class='comment'>/* Net present value of scheduled flows */</i>
    double  effDur;    <i class='comment'>/* Option adjusted duration in years */</i>
    double  effCon;    <i class='comment'>/* (vup - 2*v + vdn)/(v*(dr)^2) */</i>
    double *mats;      <i class='comment'>/* Maturities, in 30/360 years (input/output) */</i>
    double *durs;      <i class='comment'>/* Key-rate durations */</i>
};


struct <a name="struct AKAScenReport"></a><b>AKAScenReport</b>
{
    double cap0;        <i class='comment'>/* Initial capital (dirty px) per $100 face amount */</i>
    double val0;        <i class='comment'>/* Initial clean price per $100 face amount */</i>
    double acc0;        <i class='comment'>/* Initial accrued per $100 face amount */</i>
                        <i class='comment'>/* NB:  cap0 = val0 + acc0 */</i>

    double interest;    <i class='comment'>/* Interest received to horizon per $100 face */</i>
    double principal;   <i class='comment'>/* Principal received to horizon per $100 face */</i>
    double intOnInt;    <i class='comment'>/* Reinvestment income received to horizon per $100 */</i>

    double cap1;        <i class='comment'>/* Final capital per $100 face amount, is:
			   val1 + acc1 + interest + principal + intOnInt */</i>
    double val1;        <i class='comment'>/* Final clean price per $100 face amount */</i>
    double acc1;        <i class='comment'>/* Final accrued per $100 face amount */</i>

    double totalRet;    <i class='comment'>/* totalRet = cap1 - cap0 */</i>

    double dur0;        <i class='comment'>/* Initial effective duration of cap0 */</i>
    double dur1;        <i class='comment'>/* Final effective duration of cap1, but note that */</i>
                        <i class='comment'>/* dur of interest + principal + intOnInt is zero, */</i>
                        <i class='comment'>/* i.e. all intervening flows are cash at horizon */</i>

    double con0;        <i class='comment'>/* Initial effective convexity of cap0 */</i>
    double con1;        <i class='comment'>/* Final effective convexity of cap1, but note that */</i>
                        <i class='comment'>/* con of interest + principal + intOnInt is zero, */</i>
                        <i class='comment'>/* i.e. all intervening flows are cash at horizon */</i>

    double oas;         <i class='comment'>/* OAS, either given or computed */</i>

    double balance;     <i class='comment'>/* Fraction of original balance remaining */</i>
    long   redeemed;    <i class='comment'>/* Logical OR of flags from AKAScenRedemption */</i>
    long   rDate;       <i class='comment'>/* Date of option exercise if put or called */</i>
};


struct <a name="struct AKAVolReport"></a><b>AKAVolReport</b>
{
    long    n;          <i class='comment'>/* Number of maturities supplied (input) */</i>
    double  alpha;      <i class='comment'>/* Mean reversion (output) */</i>
    double *mats;       <i class='comment'>/* Maturities, in 30/360 years (input) */</i>
    double *vols;       <i class='comment'>/* Volatilities (output) */</i>
};

struct <a name="struct AKAYldWorst"></a><b>AKAYldWorst</b>
{
    long *dates;		<i class='comment'>/* all flows with option exercisable
				   and maturity date */</i>
    double *yields;		<i class='comment'>/* yield on each of the above dates */</i>
    int n;			<i class='comment'>/* number of entries in above arrays */</i>
    int worst;			<i class='comment'>/* index in above arrays with worst yield */</i>
};

struct <a name="struct AKAPrcWorst"></a><b>AKAPrcWorst</b>
{
    long *dates;		<i class='comment'>/* all flows with option exercisable
				   and maturity date */</i>
    double *prices;		<i class='comment'>/* price on each of the above dates */</i>
    int n;			<i class='comment'>/* number of entries in above arrays */</i>
    int worst;			<i class='comment'>/* index in above arrays with worst price */</i>
};

struct <a name="struct AKAAtaxYldResult"></a><b>AKAAtaxYldResult</b> {
    double principal;		<i class='comment'>/* principal, e.g., redemption at maturity */</i>
    double tax;			<i class='comment'>/* tax on principal */</i>
    double yield;		<i class='comment'>/* yield implied by final cash flow being
				   principal - tax */</i>
};


struct <a name="struct AKAAtaxYld"></a><b>AKAAtaxYld</b>
{
	<i class='comment'>/* INPUT fields - must be filled out by user */</i>
    double issue_price;		<i class='comment'>/* price at issue 100 is par */</i>
    double taxrate_short;	<i class='comment'>/* short term capital gains, 10.0 = 10% */</i>
    double taxrate_long;	<i class='comment'>/* long ... */</i>
    double taxrate_superlong;	<i class='comment'>/* super long ... &gt; 5yrs, issued since 1/1/01 */</i>
    double taxrate_income;	<i class='comment'>/* income tax rate */</i>
	<i class='comment'>/* OUTPUT fields */</i>
    struct AKAAtaxYldResult ytm; <i class='comment'>/* after tax yield to maturity */</i>
    struct AKAAtaxYldResult ytc; <i class='comment'>/* after tax yield to call */</i>
    struct AKAAtaxYldResult ytp; <i class='comment'>/* after tax yield to put */</i>
};


struct <a name="struct AKAAtaxBasis"></a><b>AKAAtaxBasis</b>
{
	<i class='comment'>/* INPUT fields - must be filled out by user */</i>
    double issue_price;		<i class='comment'>/* price at issue 100 is par */</i>
    double taxrate_short;	<i class='comment'>/* short term capital gains, 10.0 = 10% */</i>
    double taxrate_long;	<i class='comment'>/* long ... */</i>
    double taxrate_superlong;	<i class='comment'>/* super long ... &gt; 5yrs, issued since 1/1/01 */</i>
    double taxrate_income;	<i class='comment'>/* income tax rate */</i>
    long purchase_date;		<i class='comment'>/* date of purchase as yyyymmdd */</i>
    double purchase_price;	<i class='comment'>/* purchase price */</i>
	<i class='comment'>/* OUTPUT fields */</i>
    double purchase_basis;	<i class='comment'>/* bond basis on purchase date */</i>
    double holder_basis;	<i class='comment'>/* holder's basis on sale date */</i>
    double sale_basis;		<i class='comment'>/* bond basis on sale date */</i>
    double atax_price;		<i class='comment'>/* sale price adjusting for taxes */</i>
};


struct <a name="struct TREESAMPLE"></a><b>TREESAMPLE</b> {
    int nmats;			<i class='comment'>/* number of maturities - size of mats array*/</i>
    int npaths;			<i class='comment'>/* number of paths to solve for */</i>
    int ntimes;			<i class='comment'>/* number of times - size of times array */</i>
    double *mats;		<i class='comment'>/* array of maturities to solve for */</i>
    double *times;		<i class='comment'>/* array of times to solve for */</i>
    struct PATH_ITEM ***paths;	<i class='comment'>/* samples: [&lt;mat-i&gt;][&lt;path-i&gt;][&lt;time-i&gt;] */</i>
};
struct <a name="struct PATH_ITEM"></a><b>PATH_ITEM</b> {
    double rate;
    double center;
};


<i class='comment'>/* ********************************************
   USEFUL CONSTANTS
   ******************************************** */</i>
<i class='comment'>/* Define TRUE and FALSE constants, if they are not already defined. */</i>
#ifndef TRUE
#define TRUE (1==1)
#ifndef FALSE
#define FALSE (!TRUE)


enum <a name=enum_AKAQuoteType></a><b>AKAQuoteType</b>  <i class='comment'>/* Type of value supplied as input to valuation routines */</i>
{
    AKA_QUOTE_OAS   = 0,
    AKA_QUOTE_PRICE = 1,
    AKA_QUOTE_YTM   = 2,
    AKA_QUOTE_YTC   = 3,
    AKA_QUOTE_YTP   = 4
};

enum <a name=enum_AKAShiftMode></a><b>AKAShiftMode</b>  <i class='comment'>/* Shift for duration calculation */</i>
{
    AKA_SHIFT_SPOT = 0,	   <i class='comment'>/* shift the tree, ie, shift the OAS */</i>
    AKA_SHIFT_PAR  = 1,	   <i class='comment'>/* shift the par yield curve, compute a new tree 
			      For factor curves, a par rate curve is extracted
			      from the computed tree; this is then shifted */</i>
    AKA_SHIFT_NONE = 2     <i class='comment'>/* do not calculate duration or convexity */</i>
};

enum <a name=enum_AKAVolatilityMode></a><b>AKAVolatilityMode</b>  <i class='comment'>/* How the volatility input is specified */</i>
{
    AKA_VOLMODE_MEANREV = 0,
    AKA_VOLMODE_LONGVOL = 1
};

enum <a name=enum_AKACurveType></a><b>AKACurveType</b>  <i class='comment'>/* Yield curve type */</i>
{
    AKA_CURVE_FACTOR = 0,	<i class='comment'>/* discount factors */</i>
    AKA_CURVE_PAR    = 1,	<i class='comment'>/* par yields */</i>
    AKA_CURVE_ZERO   = 2,	<i class='comment'>/* zero coupon rates */</i>
    AKA_CURVE_FORWARD = 3	<i class='comment'>/* forward rates - do not use for TreeFit() */</i>
};

enum <a name=enum_AKADaycount></a><b>AKADaycount</b>  <i class='comment'>/* Supported daycounts */</i>
{
    AKA_DAYS_30_360   = 33,
    AKA_DAYS_30E_360  = 34,	<i class='comment'>/* 30/360 with European treatment of Feb. */</i>
    AKA_DAYS_ACT_360  = 39, 
    AKA_DAYS_ACT_365  = 47,
    AKA_DAYS_ACT_ACT  = 63
};

enum <a name=enum_AKAFrequency></a><b>AKAFrequency</b>  <i class='comment'>/* Supported frequencies */</i>
{
    AKA_FREQ_INT_AT_MATURITY = 0, <i class='comment'>/* implies an interest at maturity bond
				     with a semi-annual frequency for BEY yields.
				     Set security yld_method to 2,
				     (AKA_YLD_SIMPLE_LAST_PERIOD)
				     for annualized simple interest yield. */</i>
    AKA_FREQ_ANNUAL     = 1,
    AKA_FREQ_SEMIANNUAL = 2,
    AKA_FREQ_QUARTERLY  = 4,
    AKA_FREQ_MONTHLY    = 12
};

enum <a name=enum_AKA_YIELD_METHOD></a><b>AKA_YIELD_METHOD</b> {
    AKA_YLD_GLOBAL = 0,   <i class='comment'>/* use global setting, defaults to discount and can
			     be overridden with deprecated function
			     AKA_set_simple_interest_type() */</i>
    AKA_YLD_BEY = 1, <i class='comment'>/* discount cash flows using bond equivalent yield */</i>
    AKA_YLD_SIMPLE_LAST_PERIOD = 2, <i class='comment'>/* use simple interest if in final coupon*/</i>
    AKA_YLD_SIMPLE_LAST_YEAR = 3, <i class='comment'>/* use simple interest if in final year */</i>
    AKA_YLD_MUNI = 4		<i class='comment'>/* use municipal bond convention */</i>
};


enum <a name=enum_AKAOptionType></a><b>AKAOptionType</b>  <i class='comment'>/* Supported call and put option types */</i>
{
    AKA_OPTION_EUROPEAN = 0,
    AKA_OPTION_AMERICAN = 1,
    AKA_OPTION_BERMUDAN = 2	<i class='comment'>/* Deprecated; Use European and specify all call dates */</i>
};

enum <a name=enum_AKAAllocation></a><b>AKAAllocation</b>  <i class='comment'>/* Designation option in sinking funds */</i>
{
    AKA_ALLOC_PRORATA = 0,
    AKA_ALLOC_FRONT   = 1,
    AKA_ALLOC_BACK    = 2
};

enum <a name=enum_AKAScenRedemption></a><b>AKAScenRedemption</b>  <i class='comment'>/* Type of redemption returned by scenario analysis */</i>
{
    AKA_REDEEM_NONE     = 0,
    AKA_REDEEM_CALL     = 1,
    AKA_REDEEM_PUT      = 2,
    AKA_REDEEM_SINK     = 4,
    AKA_REDEEM_MATURITY = 8
};

enum <a name=enum_AKAScenType></a><b>AKAScenType</b>  <i class='comment'>/* When scenario shifts occur */</i>
{
    AKA_SCEN_NOW     = 0,  <i class='comment'>/* Suddenly at time 0 */</i>
    AKA_SCEN_GRADUAL = 1,  <i class='comment'>/* Linearly in time */</i>
    AKA_SCEN_THEN    = 2  <i class='comment'>/* Suddenly at horizon */</i>
};

enum <a name=enum_AKAPeriodType></a><b>AKAPeriodType</b>  <i class='comment'>/* Whether dates mark beginnings or ends of step-up
		       coupon periods*/</i>
{
    AKA_PERIOD_BEGIN = 0,
    AKA_PERIOD_END   = 1
};


</div>
<div class='blockcomment'>
<a name='contents19'></a><h2>Section 9. Deprecated Functions</h2>
<p>These routines are supported for backward compatibility
</p>
</div>
<div class='code'>

<i class='comment'>/* Sets whether to use simple interest calculations if the pvdate is
   within the final pay period or final year.  By default, this is off.
   MULTI-THREAD note: this routine is multi-thread safe.  It will
   change the setting for the invoking thread only. */</i>
enum <a name=enum_AKA_SIMPLE_INTEREST_TYPE></a><b>AKA_SIMPLE_INTEREST_TYPE</b> {
    AKA_SI_OFF,
    AKA_SI_LAST_PERIOD,
    AKA_SI_LAST_YEAR
};

void <a name="AKA_set_simple_interest_type"></a><b>AKA_set_simple_interest_type</b>(<a href="#enum AKA_SIMPLE_INTEREST_TYPE">enum AKA_SIMPLE_INTEREST_TYPE</a> it);

#define AKA_set_simple_interest_yield(x) \<br>	AKA_set_simple_interest_type((x) ? AKA_SI_LAST_PERIOD : AKA_SI_OFF)

#define AKA_set_global_simple_interest_yield(x) \<br>		AKA_set_simple_interest_yield(x)
#define AKA_set_thread_simple_interest_yield(x) \<br>		AKA_set_simple_interest_yield(x)

#define AKACouponSpread(pvdate, hTree, bond) AKAAssetSwapSpread(100.0, pvdate, hTree, bond)

<i class='comment'>/*		  --- old style initialization ---
   Two function interface, authorize_init() must be called before calling
   AKAInit() */</i>

#define AKATerm() AKA_shutdown_configure(0)	<i class='comment'>/* support old name */</i>

<i class='comment'>/* Check user authorization to access library.  Returns TRUE if a valid
   key for the user was provided, otherwise FALSE.
   A valid key can be expired. This will show up when init is called */</i>
int <a name="AKA_authorize_init"></a><b>AKA_authorize_init</b>(long key, char *uname);

<i class='comment'>/* Initialize with settings.  If initdata == NULL default settings are used
   returns one of AKAINIT_ERR_ defined above */</i>
long <a name="AKAInit"></a><b>AKAInit</b>(<a href="#AKAINITDATA">AKAINITDATA</a> *config);

</div>
<div class='blockcomment'>
<p>The following two functions handled calculating duration outside of
the standard bond valuation functions, AKABondVal() and
AKABondVal2().  This was due to inefficiencies in computing duration
shifts due to the handling of the shifted trees needed in the
valuations.  This is no longer the case and they should not be used.
ABABondVal() or AKABondVal2() should be used instead.
</p>
</div>
<div class='code'>

<i class='comment'>/* Create two shifted trees suitable for computing duration.  The
   input is the original tree and the basis points to shift.  The
   bpShift is passed as a pointer, is always a positive number, and
   may be updated in the function.  The down-shifted and up-shifted
   trees are returned in the pointer reference parameters passed into
   the routine.  The trees are fitted by shifting the par curve
   by bpShift basis points.  If this fails, the bpShift value is
   adjusted until the trees can be successfully fitted.
   A tree will fail to fit when shifting causes
   excessively low rates.
   This routine returns 1 on success and 0 on failure.
 */</i>
int <a name="AKATreeFitShift2"></a><b>AKATreeFitShift2</b>(<a href="#AKAHTREE">AKAHTREE</a> tree, double *bpShift,
		     <a href="#AKAHTREE">AKAHTREE</a> *treeup, <a href="#AKAHTREE">AKAHTREE</a> *treedown);


<i class='comment'>/* Calculate the convexity and duration values assuming that the bond
   report is already filled out with the other data (price, OAS,
   accrued).  For use with AKA_SHIFT_NONE.  The hTree_up and
   hTree_down trees are assumed to be trees which were created by
   shifting the yield curve durbp basis points up and down.  These
   trees can be created by shifting the original curve and calling
   AKATreeFit() or by using AKATreeFitShift().  The price and OAS
   values in the rpt are assumed to have come by valuing the bond with
   the unshifted tree. */</i>
long <a name="AKABondDuration"></a><b>AKABondDuration</b>(long pvdate, <a href="#AKAHTREE">AKAHTREE</a> hTree_up, <a href="#AKAHTREE">AKAHTREE</a> hTree_down,
		     double durbp, const <a href="#AKABOND">AKABOND</a> *bond, <a href="#AKABONDREPORT">AKABONDREPORT</a> *rpt);



<i class='comment'>/* Fit a tree from a set of curves */</i>
<i class='comment'>/* ********************************************
   INTEREST RATE structure alternative form composed from known prices
   of bonds and zero coupon rates
   ******************************************** */</i>
struct <a name="struct AKARun"></a><b>AKARun</b>
{
    long    mode;    <i class='comment'>/* Select from <a href="#enum_AKAVolatilityMode">AKAVolatilityMode</a>: */</i>
                     <i class='comment'>/* AKA_VOLMODE_MEANREV:  Supply mean reversion,
			compute lvol */</i>
                     <i class='comment'>/* AKA_VOLMODE_LONGVOL:  Supply lvol,
			compute mean reversion */</i>

    double  vol;     <i class='comment'>/* Short-rate volatility, 12% represented as 12.0 */</i>
    double  lvol;    <i class='comment'>/* 30-year rate volatility, 10% represented as 10.0 */</i>
    double  alpha;   <i class='comment'>/* Mean reversion speed, 2% represented as 2.0 */</i>

    long      pvdate;        <i class='comment'>/* Required to price instruments, */</i>
                             <i class='comment'>/* but tree is independent of time. */</i>

    long      nBonds;        <i class='comment'>/* Number of bonds */</i>
    AKABOND **bonds;         <i class='comment'>/* Optionless bond specifications */</i>
    double   *bondPx;        <i class='comment'>/* Clean bond prices */</i>

    long      nRates;        <i class='comment'>/* Number of zero coupon rates */</i>
    long     *rateDaycount;  <i class='comment'>/* Appropriate daycount type */</i>
    long     *rateMat;       <i class='comment'>/* Discount note maturities */</i>
    double   *rate;          <i class='comment'>/* Discount rates */</i>
};
typedef struct <a href="#struct AKARun">AKARun</a> <a name=AKARUN></a><b>AKARUN</b>;
</div>
<div class='blockcomment'>
<p>This function is no longer supported.  It will always return a zero
(failed) tree and generate an error message
</p>
</div>
<div class='code'>
<a href="#AKAHTREE">AKAHTREE</a> <a name="AKATreeFitRun"></a><b>AKATreeFitRun</b>(const <a href="#AKARUN">AKARUN</a> *crv, const <a href="#AKASPREAD">AKASPREAD</a> *spr);
AKARUN * AKARunAlloc(long nBonds, long nRates);
AKARUN * AKARunFree(AKARUN *run);

}

</div>
<hr>
<a name='contents20'></a><h2>Index of Functions</h2>
<a href="#AKAAfterTax">AKAAfterTax</a><br>
<a href="#AKAAssetSwapSpread">AKAAssetSwapSpread</a><br>
<a href="#AKAAtaxBasis">AKAAtaxBasis</a><br>
<a href="#AKAAtaxYield">AKAAtaxYield</a><br>
<a href="#AKABondAccrued">AKABondAccrued</a><br>
<a href="#AKABondAccrued2">AKABondAccrued2</a><br>
<a href="#AKABondDuration">AKABondDuration</a><br>
<a href="#AKABondFlow">AKABondFlow</a><br>
<a href="#AKABondFlowOnly">AKABondFlowOnly</a><br>
<a href="#AKABondKRDur">AKABondKRDur</a><br>
<a href="#AKABondKeyDur">AKABondKeyDur</a><br>
<a href="#AKABondKeyDur2">AKABondKeyDur2</a><br>
<a href="#AKABondKeyDur3">AKABondKeyDur3</a><br>
<a href="#AKABondOAS">AKABondOAS</a><br>
<a href="#AKABondPrice">AKABondPrice</a><br>
<a href="#AKABondPriceCnv">AKABondPriceCnv</a><br>
<a href="#AKABondPriceShifted">AKABondPriceShifted</a><br>
<a href="#AKABondScen">AKABondScen</a><br>
<a href="#AKABondScen2">AKABondScen2</a><br>
<a href="#AKABondScen3">AKABondScen3</a><br>
<a href="#AKABondScen4">AKABondScen4</a><br>
<a href="#AKABondTaxRate">AKABondTaxRate</a><br>
<a href="#AKABondVal">AKABondVal</a><br>
<a href="#AKABondVal2">AKABondVal2</a><br>
<a href="#AKABondValueYields">AKABondValueYields</a><br>
<a href="#AKABondValueYieldsEx">AKABondValueYieldsEx</a><br>
<a href="#AKAConvertAssetSwapSpread">AKAConvertAssetSwapSpread</a><br>
<a href="#AKADefaultTaxRate">AKADefaultTaxRate</a><br>
<a href="#AKAFatalReset">AKAFatalReset</a><br>
<a href="#AKAFatalStatus">AKAFatalStatus</a><br>
<a href="#AKAFwdRates">AKAFwdRates</a><br>
<a href="#AKAFwdRatesFromCurve">AKAFwdRatesFromCurve</a><br>
<a href="#AKAISpread">AKAISpread</a><br>
<a href="#AKAInit">AKAInit</a><br>
<a href="#AKAKeyDurSetup">AKAKeyDurSetup</a><br>
<a href="#AKAKeyDurSetupFree">AKAKeyDurSetupFree</a><br>
<a href="#AKALowestYieldToSink">AKALowestYieldToSink</a><br>
<a href="#AKAPriceToWorst">AKAPriceToWorst</a><br>
<a href="#AKATreeFit">AKATreeFit</a><br>
<a href="#AKATreeFitRun">AKATreeFitRun</a><br>
<a href="#AKATreeFitShift">AKATreeFitShift</a><br>
<a href="#AKATreeFitShift2">AKATreeFitShift2</a><br>
<a href="#AKATreeFitSpreads">AKATreeFitSpreads</a><br>
<a href="#AKATreeFitZero">AKATreeFitZero</a><br>
<a href="#AKATreeMinRate">AKATreeMinRate</a><br>
<a href="#AKATreeRelease">AKATreeRelease</a><br>
<a href="#AKAYieldToWorst">AKAYieldToWorst</a><br>
<a href="#AKAYieldToWorstEx">AKAYieldToWorstEx</a><br>
<a href="#AKAYieldVol">AKAYieldVol</a><br>
<a href="#AKA_authorize_expiration_date">AKA_authorize_expiration_date</a><br>
<a href="#AKA_authorize_init">AKA_authorize_init</a><br>
<a href="#AKA_initialize">AKA_initialize</a><br>
<a href="#AKA_initialize_configure">AKA_initialize_configure</a><br>
<a href="#AKA_initialize_get_defaults">AKA_initialize_get_defaults</a><br>
<a href="#AKA_memory_diagnostics">AKA_memory_diagnostics</a><br>
<a href="#AKA_msg_pop">AKA_msg_pop</a><br>
<a href="#AKA_msg_push">AKA_msg_push</a><br>
<a href="#AKA_msg_status">AKA_msg_status</a><br>
<a href="#AKA_msg_suppress">AKA_msg_suppress</a><br>
<a href="#AKA_set_duration_shift">AKA_set_duration_shift</a><br>
<a href="#AKA_set_simple_interest_type">AKA_set_simple_interest_type</a><br>
<a href="#AKA_shutdown">AKA_shutdown</a><br>
<a href="#AKA_shutdown_configure">AKA_shutdown_configure</a><br>
<a href="#AKA_treesample">AKA_treesample</a><br>
<a href="#AKA_treesample_alloc">AKA_treesample_alloc</a><br>
<a href="#AKA_treesample_free">AKA_treesample_free</a><br>
<a href="#AKA_version">AKA_version</a><br>
<a href="#AKA_version_string">AKA_version_string</a><br>
<div id='contents'>
<span onclick='toggle_contents()'>Contents</span>
<div style='display: none;' id='inner_contents'><ul>
<li><a href='#contents0'>BondOAS Library Description</a></li>
<ul>
<li><a href='#contents1'>Lattice calibration</a></li>
<li><a href='#contents2'>Valuation</a></li>
<li><a href='#contents3'>Coverage</a></li>
<li><a href='#contents4'>Lattice-based Calculations</a></li>
<li><a href='#contents5'>Conventional Bond Calculations</a></li>
<li><a href='#contents6'>Scenario Analysis and Stress Testing</a></li>
<li><a href='#contents7'>Applications</a></li>
<li><a href='#contents8'>Performance</a></li>
</ul>
<li><a href='#contents9'>BondOAS Library API &mdash; akaapi.h</a></li>
<ul>
<li><a href='#contents10'>Overview</a></li>
<li><a href='#contents11'>Section 1. General Notes</a></li>
<li><a href='#contents12'>Section 2. Initialization and Shutdown</a></li>
<li><a href='#contents13'>Section 3. Tree Creation</a></li>
<li><a href='#contents14'>Section 4. Valuation</a></li>
<li><a href='#contents15'>Section 5. Miscellaneous Functions</a></li>
<li><a href='#contents16'>Section 6. Error Handling</a></li>
<li><a href='#contents17'>Section 7. Memory Allocation and Free</a></li>
<li><a href='#contents18'>Section 8. Data Structures and Constants</a></li>
<li><a href='#contents19'>Section 9. Deprecated Functions</a></li>
<li><a href='#contents20'>Index of Functions</a></li>
</ul>
</ul></div></div>
</body></html>
